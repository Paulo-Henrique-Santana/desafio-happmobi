<div class="home-container">
  <div class="page-header page-header--user">
    <div class="header-content">
      <div class="user-info">
        <app-photo-upload 
          [photoPreview]="user.photo" 
          [rounded]="true"
          [readonly]="true"
          [size]="'small'"
        />
        <p class="greeting">Olá, {{ user.name }}</p>
      </div>
    </div>
  </div>

  <div class="content">
    <div class="search-section">
      <div class="search-bar">
        <img src="/assets/images/search-icon.svg" alt="Buscar" class="search-icon" />
        <input 
          type="text" 
          placeholder="Buscar carro" 
          class="search-input"
          [(ngModel)]="searchQuery"
          (ngModelChange)="onSearchChange($event)"
        />
      </div>
      
      <button class="filter-button" (click)="openFilterModal()">
        <img src="/assets/images/filter-icon.svg" alt="Filtrar" class="filter-icon" />
        <span>Filtrar</span>
      </button>
    </div>

    @if (hasSearchOrFilters) {
      <div class="search-results-section">
        <h2 class="section-title">Resultados da busca</h2>
        <div class="vehicles-list">
          @if (userReservations$ | async; as reservations) {
            @for (vehicle of searchResults; track vehicle.id) {
              <app-vehicle-card 
                [vehicle]="vehicle" 
                [isReserved]="isVehicleReserved(vehicle.id, reservations)"
                [reservationId]="getReservationId(vehicle.id, reservations)"
                (reserveVehicle)="openReservationModal($event)"
                (cancelReservation)="onCancelReservation($event)"
              />
            }
          }
        </div>
      </div>

      <div class="section-divider"></div>
    }

    <div class="last-reservations-section">
      <h2 class="section-title">Últimas reservas</h2>
      <div class="vehicles-list">
      @if (lastReservations$ | async; as vehicles) {
        @if (userReservations$ | async; as reservations) {
          @for (vehicle of vehicles; track vehicle.id) {
            <app-vehicle-card 
              [vehicle]="vehicle" 
              [isReserved]="isVehicleReserved(vehicle.id, reservations)"
              [reservationId]="getReservationId(vehicle.id, reservations)"
              (reserveVehicle)="openReservationModal($event)"
              (cancelReservation)="onCancelReservation($event)"
            />
          }
        }
      }
    </div>
    </div>
  </div>

  <app-filter-modal
    [isOpen]="isFilterModalOpen"
    [activeFilters]="activeFilters"
    (closeModal)="closeFilterModal()"
    (applyFilters)="applyFilters($event)"
  />

  <app-reservation-modal
    [isOpen]="isReservationModalOpen"
    [vehicle]="selectedVehicle"
    (closeModal)="closeReservationModal()"
    (reservationSuccess)="onReservationSuccess()"
  />

  <app-navigation />
</div>
